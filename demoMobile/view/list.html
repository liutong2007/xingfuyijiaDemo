<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8">
    <title>作品列表</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,target-densitydpi=high-dpi,minimal-ui " />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="blank" />
    <script src="../static/js/rem.js"></script>
    <link rel="stylesheet" href="../static/exhibitions/swiper.min.css">
    <link rel="stylesheet" href="../static/css/reset.css">
    <link rel="stylesheet" href="../static/css/page.css?t=1582615270036">
    <script type="text/javascript" src="../static/js/bigData_wap.js"></script>
    <script type="text/javascript" src="../static/exhibitions/swiper.min.js?1593573541606"></script>
  </head>
  
  <body class="pageBar searchBody">
    <header id="bar" class="bar">
        <a class="home" onclick="window.history.back()">
            <img src="../static/imgs/back_icon.png" alt="">
        </a>
        <div class="topBtn">
            <div id="topMenu" class="topMenu">
                <b class="icon menuIco"><img src="../static/imgs/list_more_icon.png"></b>
                <div class="menuItem">
                <ul>
                    <li>
                    <a href="../index.html">首页</a>
                    </li>
                    <!-- <li>
                    <a href="/activities/cnaf2016/activity">活动详情</a>
                    </li>
                    <li>
                    <a href="/activities/cnaf2016/guize">投票规则</a>
                    </li> -->
                    <!-- <li>
                        <a href="/activities/cnaf2016/works">作品</a>
                    </li> -->
                    <!-- <li>
                    <a href="/activities/cnaf2016/news">新闻汇总</a>
                    </li> -->
                </ul>
                </div>
            </div>
        </div>
        <h1 class="yunpingxuan">云评选</h1>
        <h1 class="yunzhanlan">云展览</h1>
    </header>
    <div class="body">
        
      <section class="caty tabs colum4">
        <ul class="fix cTags">
            <li>
                <a href="javascript:;">作品分类</a>
            </li>
          <!-- <li>
            <a href="javascript:;">作品情况</a></li> -->
        </ul>
        <div class="search-list">
            <a id="searchBtn"></a>
        </div>
        <div class="fullPage tabCont">
          <div class="cList">
            <a class="curr" data-id="">全部</a>
            <a data-id="shufa">书法</a>
            <a data-id="huihua">绘画</a>
            <a data-id="sheying">摄影</a>
        </div>
      </section>
      <section id="waterFall" class="waterFall fix">
        <ul class="waterCol" id="worksList"></ul>
      </section>
    </div>
    <div id="searchShow" class="searchShow fullPage">
      <div class="search">
        <span id="sBtn" class="sBtn">确定</span>
        <div class="sForm">
          <n class="iconSearch icon">&#xe60a;</n>
          <input id="searchInput" type="search" placeholder="请输入作品名称或作者名称" autocomplete="off" onkeyup='javascript:cSearch(event);'></div>
      </div>
    </div>
    <!-- <div id="fixNav" class="fixNav">
      <div id="goTop" class="icon goTop">&#xe607;</div>
      <a id="website" href="/activities/cnaf2016/" class="icon website">&#xe605;</a>
      <a id="hatchLink" href="/" class="icon hatchIcon ">&#xe900;</a>
      <div id="tel" class="icon tel">
        <a href="tel:01080451143">&#xe609;</a></div>
    </div>
    <input id="voteLinks" type="hidden" value="/activities/checkVote/index/1021">
    <input id="inAppAct" type="hidden" value="0">
    <input id="router" type="hidden" value="/activities/cnaf2016/works-0-0-36-2016-0-1/" /> -->
  </body>
  <script src="../static/js/page.js?149682"></script>
  <script src="../static/js/jquery-1.11.0.min.js"></script>
    <!--下载引导开始-->
    <!--下载引导结束-->
    <script>
        // (function() {
        //     var oDownload = document.querySelector('.downloadBarBox'),
        //     oClose = oDownload.querySelector('.closeBar');
        //     oClose.addEventListener('click',
        //     function() {
        //     oDownload.style.display = 'none';
        //     },
        //     !1)
        // })()
        $(function(){
            var pageIndex = 1
            var pageLimit = 10
            var sf_pageIndex = 1
            var sf_pageLimit = 10
            var hh_pageIndex = 1
            var hh_pageLimit = 10
            var sy_pageIndex = 1
            var sy_pageLimit = 10
            $('.cList a').click(function(){
                $('.cList a').removeClass('curr')
                $('.cTags li a').text($(this).text())
                $(this).addClass('curr')
                var type = $(this).attr('data-id')
                $('#worksList').html('')
                pageIndex = 1
                sf_pageIndex = 1
                hh_pageIndex = 1
                sy_pageIndex = 1
                getWorksList(type, pageIndex, pageLimit, 'worksList')
            })
            // 获取作品列表
            getWorksList('', pageIndex, pageLimit, 'worksList')
            function getWorksList(type, pageIndex, pageLimit, ul) {
                var url = ''
                var obj = {}
                if (type !== '') {
                    url = httpUrl+'proxyApi/getList.php?act=type&type='+type
                } else {
                    url = httpUrl+'proxyApi/getList.php?act=tp'
                }
                obj.page = pageIndex
                obj.limit = pageLimit
                $.ajax({
                    url: url,
                    type: 'get',
                    data: obj,
                    success: function(res){
                        if (res.code == 200) {
                            var list = res.info.list
                            var html = ''
                            list.forEach(element => {
                                console.log(element)
                                html+= `<li>
                                    <a href="detail.html?type=${getQueryString('type')}&id=${element.id}" class="reset-link">
                                        <div class="identify">
                                        <img src="${httpUrl+'/proxyApi/'+element.imgs}">
                                        <cite>获奖作品</cite>
                                        </div>
                                        <div class="yunzhanlan">
                                            <h3>${element.works_name}<p class="gal">${element.area+'-'+element.author_name}</p></h3>
                                            <p class="zuopin-jianjie">
                                                ${'作品编号:'+element.id+' '+element.discribe}
                                            </p>
                                        </div>
                                    </a>
                                    <div class="yunpingxuan">
                                        <p class="toupiao-btn-box">
                                            <span>票数 <i>${element.vote_count}</i></span>
                                            <a class="toupiao-btn" href="javascript:;" data-id="${element.id}">投票</a>
                                        </p>
                                    </div>
                                </li>
                                `
                            });
                            $('#'+ul).append(html)
                            if (getQueryString('type') == 1) {
                                $('.yunpingxuan').show()
                            } else {
                                $('.yunzhanlan').show()
                            }
                        }
                    }
                })
            }
            // 投票接口
            function sendVote (id, el) {
                let obj = {id: id}
                $.ajax({
                    url: httpUrl+'proxyApi/vote.php',
                    type: 'get',
                    data: obj,
                    success: function(res){
                        if (res.code == 200) {
                            alert('投票成功');
                            console.log(el.prev('span'))
                            var number = el.prev('span').find('i')
                            number.text(Number(number.text())+1)
                        } else {
                            alert(res.msg)
                        }
                    }
                })
            }
            $(document.body).on('click', 'a.toupiao-btn', function(){
                var id = $(this).attr('data-id')
                sendVote(id, $(this))
            })
            console.log(getQueryString('type'))
            if (getQueryString('type') == 1) {
                $('.yunpingxuan').show()
            } else {
                $('.yunzhanlan').show()
            }
            $('.reset-link').attr('href', 'detail.html?type='+getQueryString('type'))
            $('#searchBtn').click(function(){
                $('#searchShow').show();
            })
            $('#sBtn').click(function(){
                $('#searchShow').hide();
            })
        })
    </script>
    <script>
      /*搜索层*/
      function searchShow(oSearch) {
        var sWrap = document.getElementById('searchShow'),
        sBtn = document.getElementById('sBtn');
        sBtn.addEventListener('click',
        function() {
          searchWord();
        },
        false);
        AfedFn.lightBox(oSearch, sWrap, sBtn);
      }
      function searchWord() {
        var searchObj = document.getElementById('searchInput');
        var SearchWord = searchObj.value;
        window.location.href = "/exhibitions/works/?keyword=" + encodeURI(SearchWord);
      }
      function cSearch(e) {
        var event = window.event || e;
        if (event.keyCode == 13) {
          searchWord();
        }
      }
      function SearchClass(ClassCode) {
        var searchObj = document.getElementById('searchInput');
        var SearchWord = searchObj.value;
        if (ClassCode === 0) SearchWord = '';
        window.location.href = "?SearchWord=" + encodeURI(SearchWord) + "&ClassCode=" + ClassCode;
      }
    </script>
</html>